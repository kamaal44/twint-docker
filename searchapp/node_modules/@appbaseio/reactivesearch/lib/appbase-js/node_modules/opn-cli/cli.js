#!/usr/bin/env node

'use strict';

var meow = require('meow');
var opn = require('opn');
var getStdin = require('get-stdin');
var tempWrite = require('temp-write');
var fileType = require('file-type');

var cli = meow('\n\tUsage\n\t  $ opn <file|url> [--wait] [-- <app> [args]]\n\t  $ cat <file> | opn [--wait] [--ext] [-- <app> [args]]\n\n\tOptions\n\t  --wait  Wait for the app to exit\n\t  --ext   File extension for when stdin file type can\'t be detected\n\n\tExamples\n\t  $ opn http://sindresorhus.com\n\t  $ opn http://sindresorhus.com -- firefox\n\t  $ opn http://sindresorhus.com -- \'google chrome\' --incognito\n\t  $ opn unicorn.png\n\t  $ cat unicorn.png | opn\n\t  $ echo \'<h1>Unicorns!</h1>\' | opn --ext=html\n', {
	default: {
		wait: false
	}
});

cli.flags.app = cli.input.slice(1);

var input = cli.input[0];

if (!input && process.stdin.isTTY) {
	console.error('Specify a filepath or URL');
	process.exit(1);
}

if (input) {
	opn(input, cli.flags);
} else {
	getStdin.buffer().then(function (stdin) {
		var type = fileType(stdin);
		var ext = cli.flags.ext || type && type.ext || 'txt';
		opn(tempWrite.sync(stdin, 'opn.' + ext), cli.flags);
	});
}